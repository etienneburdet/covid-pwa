<!DOCTYPE html>
<html>

<head>
  <title>ODS Widgets Minimal Boilerplate</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.4.0/css/font-awesome.min.css">
</head>

<body>
  <div class="container" ng-app="ods-widgets">
    <section class="sticky-content">
      <h2 class="text-primary text-center mb-4">
        COVID-19 epidemiliogic status in Castilla y León (last update 17/03/2020)
      </h2>
    </section>
    <ods-dataset-context context="regions, cases, selected"
      cases-domain="https://analisis.datosabiertos.jcyl.es"
      cases-dataset="situacion-epidemiologica-coronavirus-en-castilla-y-leon"
      selected-domain="https://analisis.datosabiertos.jcyl.es"
      selected-dataset="situacion-epidemiologica-coronavirus-en-castilla-y-leon"
      selected-parameters="{'disjunctive.provincia':true}"
      regions-dataset="limites-provinciales-de-castilla-y-leon-recintos"
      regions-domain="https://analisis.datosabiertos.jcyl.es">
      <div class="row justify-content-around">
        <div id="confirmed-cases" class="insight-card col-xs-3">
          <h3 class="text-highlight">49</h3>
          <p class="text-light">confirmed cases</p>
        </div>
        <div id="new-cases" class="insight-card col-xs-3">
          <h3 class="text-highlight">49</h3>
          <p class="text-light">confirmed new-cases</p>
        </div>
        <div id="hospitalized" class="insight-card col-xs-3">
          <h3 class="text-highlight">49</h3>
          <p class="text-light">hospitalized</p>
        </div>
        <div id="hospitalized-uci" class="insight-card col-xs-3">
          <h3 class="text-highlight">49</h3>
          <p class="text-light">hospitalized UCI</p>
        </div>
        <div id="Altas" class="insight-card col-xs-3">
          <h3 class="text-highlight">49</h3>
          <p class="text-light">Altas</p>
        </div>
        <div id="fatalities" class="insight-card col-xs-3">
          <h3 class="text-highlight">49</h3>
          <p class="text-light">Fatalities</p>
        </div>
      </div>

      <div class="row feature-box" ng-init="tabselector = 'firsttab'">
        <div class="col-xs-12">
          <div class="tabs">
            <a class="tab" ng-click="tabselector = 'firsttab'" ng-class="{'activetab' : tabselector == 'firsttab'}">
              New cases
            </a>
            <a class="tab" ng-click="tabselector = 'secondtab'" ng-class="{'activetab' : tabselector == 'secondtab'}">
              Hospitalized
            </a>
            <a class="tab" ng-click="tabselector = 'thirdtab'" ng-class="{'activetab' : tabselector == 'thirdtab'}">
              Fatalities
            </a>
          </div>
          <div class="col-xs-12" ng-if="tabselector == 'firsttab'">
            <div ng-init="colors = {};">
              <div ods-analysis="analyseregions"
                ods-analysis-context="cases"
                ods-analysis-x="codigo_ine"
                ods-analysis-max="0"
                ods-analysis-serie-agg="SUM(casos_confirmados)"
                ods-analysis-sort="agg">
                <div ods-subaggregation="analyseregions.results"
                  ods-subaggregation-serie-maxval="MAX(agg)"
                  ods-subaggregation-serie-minval="MIN(agg)">
                  <span ng-repeat="res in analyseregions.results">
                    {{reg_code = res.x > 9999 ? (res.x | limitTo:2) : (res.x | limitTo:1); ""}}
                    {{colors[reg_code] = "hsl(220,75%," + (75 - ((res.agg - results[0].minval) / (results[0].maxval - results[0].minval) * 50) | number : 0) + "%,1)"; "" }}
                  </span>
                </div>
              </div>
              <ods-map basemap="jawg.light" no-refit="false" scroll-wheel-zoom="false" display-control="false" toolbar-drawing="false">
                <ods-map-layer context="regions" color-categories="colors" color-by-field="cod_ine_prov" color-categories-other="lightgrey" display="categories" shape-opacity="0.7" tooltip-disabled="true"></ods-map-layer>
              </ods-map>
            </div>
          </div>
          <div class="col-xs-12" ng-if="tabselector == 'secondtab'">
            <ods-map context="cases" ng-if="tabselector == 'thirdtab'"></ods-map>
          </div>
          <div class="col-xs-12">
            <ods-map context="cases" ng-if="tabselector == 'thirdtab'"></ods-map>
          </div>
        </div>
      </div>

      <div class="row feature-box"
        ng-init="active_row = {}">
        <div class="col-xs-12">
          <table class="summary-table">
            <thead>
              <th>Region</th>
              <th>Confirmed</th>
              <th>Altas</th>
              <th>Fatalities</th>
            </thead>
            <tbody>
              <tr ods-analysis="sumregion"
                    ods-analysis-context="cases"
                    ods-analysis-max="100"
                    ods-analysis-x="provincia"
                    ods-analysis-sort="count"
                    ods-analysis-serie-confirmados="SUM(casos_confirmados)"
                    ods-analysis-serie-altas="SUM(altas)"
                    ods-analysis-serie-fallecimientos="SUM(fallecimientos)"
                    ng-repeat="region in sumregion.results"
                    ng-class="{'toggled': toggled}">
                <td>
                  <div>
                    <input id="{{ region.x }}" type="checkbox" class="hidden-checkbox"
                      ods-toggle-model="$parent.selected.parameters"
                      ods-toggle-key="refine.provincia"
                      ods-toggle-value="{{ region.x }}"/>
                    <label for="{{ region.x }}" class="fake-checkbox" ng-click="toggled = !toggled"></label>
                    {{ region.x }}
                  </div>
                </td>
                <td>{{  region.confirmados }}</td>
                <td>{{  region.altas }}</td>
                <td>{{  region.fallecimientos }}</td>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="col-xs-6">
          <h4 class="text-primary text-center">Tendencia</h4>
          <ods-chart timescale="year" single-y-axis="true" scientific-display="false" align-month="true">
            <ods-chart-query context="selected" field-x="fecha" maxpoints="0" timescale="day">
              <ods-chart-serie expression-y="casos_confirmados" chart-type="spline" function-y="SUM" label-y="Casos confirmados" color="#00c7b1" scientific-display="true" display-values="true">
              </ods-chart-serie>
              <ods-chart-serie expression-y="fallecimientos" chart-type="line" function-y="SUM" label-y="Fallecimientos" color="#fc8d62" scientific-display="true" display-values="true">
              </ods-chart-serie>
            </ods-chart-query>
          </ods-chart>
        </div>
        <div class="col-xs-6">
          <h4 class="text-primary text-center">Incremento diario</h4>
          <ods-chart timescale="year" align-month="true">
              <ods-chart-query context="selected" field-x="fecha" maxpoints="0" timescale="day">
                  <ods-chart-serie expression-y="nuevos_positivos" chart-type="column" function-y="SUM" label-y="Nuevos casos positivos" color="#00c7b1" display-values="true" display-stack-values="false" scientific-display="true">
                  </ods-chart-serie>
              </ods-chart-query>
          </ods-chart>
        </div>
      </div>
    </ods-dataset-context>

  </div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.4.7/angular.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.4.7/angular-sanitize.min.js"></script>
  <script type="text/javascript" src="https://opendatasoft.github.io/ods-widgets/dist/ods-widgets.js"></script>
</body>

</html>
